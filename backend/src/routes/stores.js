// ===================================================
// Store Builder Routes\n// ===================================================

const express = require('express');
const router = express.Router();
const { authMiddleware } = require('../middleware/auth');

// ===================================================
// Create Store\n// ===================================================\n\nrouter.post('/create', authMiddleware, async (req, res) => {\n  try {\n    const { store_name, niche, products } = req.body;\n\n    if (!store_name || !niche) {\n      return res.status(400).json({\n        success: false,\n        error: 'store_name and niche are required'\n      });\n    }\n\n    console.log(`ðŸª Creating store: ${store_name}`);\n\n    // Simulated store creation\n    const store = {\n      id: 'store_' + Math.random().toString(36).substr(2, 9),\n      user_id: req.user.id,\n      store_name,\n      niche,\n      domain: `${store_name.toLowerCase().replace(/\\s+/g, '-')}.dropforge.ai`,\n      status: 'active',\n      products: products || [],\n      theme: 'modern',\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      stats: {\n        views: 0,\n        clicks: 0,\n        conversions: 0,\n        revenue: 0\n      }\n    };\n\n    res.json({\n      success: true,\n      data: store,\n      message: 'Store created successfully',\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('âŒ Store creation error:', error.message);\n    res.status(500).json({\n      success: false,\n      error: error.message\n    });\n  }\n});\n\n// ===================================================\n// Get User Stores\n// ===================================================\n\nrouter.get('/my-stores', authMiddleware, async (req, res) => {\n  try {\n    console.log(`ðŸ“‹ Getting stores for user: ${req.user.id}`);\n\n    // Simulated user stores\n    const stores = [\n      {\n        id: 'store_1',\n        store_name: 'Yoga Essentials',\n        niche: 'Fitness',\n        domain: 'yoga-essentials.dropforge.ai',\n        status: 'active',\n        products: 5,\n        created_at: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),\n        stats: {\n          views: 1250,\n          clicks: 145,\n          conversions: 23,\n          revenue: 1840\n        }\n      },\n      {\n        id: 'store_2',\n        store_name: 'Tech Gadgets Hub',\n        niche: 'Electronics',\n        domain: 'tech-gadgets-hub.dropforge.ai',\n        status: 'active',\n        products: 8,\n        created_at: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),\n        stats: {\n          views: 890,\n          clicks: 98,\n          conversions: 12,\n          revenue: 960\n        }\n      }\n    ];\n\n    res.json({\n      success: true,\n      data: stores,\n      count: stores.length,\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('âŒ Get stores error:', error.message);\n    res.status(500).json({\n      success: false,\n      error: error.message\n    });\n  }\n});\n\n// ===================================================\n// Get Store Details\n// ===================================================\n\nrouter.get('/:store_id', authMiddleware, async (req, res) => {\n  try {\n    const { store_id } = req.params;\n\n    console.log(`ðŸ“‹ Getting store details: ${store_id}`);\n\n    // Simulated store details\n    const storeDetails = {\n      id: store_id,\n      store_name: 'Yoga Essentials',\n      niche: 'Fitness',\n      domain: 'yoga-essentials.dropforge.ai',\n      status: 'active',\n      theme: 'modern',\n      products: 5,\n      created_at: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),\n      settings: {\n        currency: 'USD',\n        shipping_cost: 5.99,\n        tax_rate: 0.08,\n        return_policy: '30 days'\n      },\n      stats: {\n        views: 1250,\n        clicks: 145,\n        conversions: 23,\n        revenue: 1840,\n        average_order_value: 80,\n        conversion_rate: 15.9\n      },\n      products: [\n        {\n          id: 'prod_1',\n          title: 'Premium Yoga Mat',\n          price: 49.99,\n          cost: 5.00,\n          image: 'https://via.placeholder.com/300x300',\n          sales: 12,\n          revenue: 599.88\n        }\n      ]\n    };\n\n    res.json({\n      success: true,\n      data: storeDetails,\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('âŒ Store details error:', error.message);\n    res.status(500).json({\n      success: false,\n      error: error.message\n    });\n  }\n});\n\n// ===================================================\n// Add Product to Store\n// ===================================================\n\nrouter.post('/:store_id/products', authMiddleware, async (req, res) => {\n  try {\n    const { store_id } = req.params;\n    const { product_id, title, price, description, image } = req.body;\n\n    if (!product_id || !title || !price) {\n      return res.status(400).json({\n        success: false,\n        error: 'product_id, title, and price are required'\n      });\n    }\n\n    console.log(`âž• Adding product to store: ${store_id}`);\n\n    // Simulated product add\n    const storeProduct = {\n      id: 'store_prod_' + Math.random().toString(36).substr(2, 9),\n      store_id,\n      product_id,\n      title,\n      price,\n      description,\n      image,\n      status: 'published',\n      created_at: new Date().toISOString(),\n      stats: {\n        views: 0,\n        clicks: 0,\n        sales: 0\n      }\n    };\n\n    res.json({\n      success: true,\n      data: storeProduct,\n      message: 'Product added to store',\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('âŒ Add product error:', error.message);\n    res.status(500).json({\n      success: false,\n      error: error.message\n    });\n  }\n});\n\n// ===================================================\n// Update Store Settings\n// ===================================================\n\nrouter.put('/:store_id/settings', authMiddleware, async (req, res) => {\n  try {\n    const { store_id } = req.params;\n    const { theme, currency, shipping_cost, tax_rate } = req.body;\n\n    console.log(`âš™ï¸ Updating store settings: ${store_id}`);\n\n    // Simulated settings update\n    const updatedSettings = {\n      store_id,\n      theme: theme || 'modern',\n      currency: currency || 'USD',\n      shipping_cost: shipping_cost || 5.99,\n      tax_rate: tax_rate || 0.08,\n      updated_at: new Date().toISOString()\n    };\n\n    res.json({\n      success: true,\n      data: updatedSettings,\n      message: 'Settings updated successfully',\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('âŒ Settings update error:', error.message);\n    res.status(500).json({\n      success: false,\n      error: error.message\n    });\n  }\n});\n\n// ===================================================\n// Get Store Analytics\n// ===================================================\n\nrouter.get('/:store_id/analytics', authMiddleware, async (req, res) => {\n  try {\n    const { store_id } = req.params;\n    const { period = '30' } = req.query;\n\n    console.log(`ðŸ“Š Getting analytics for store: ${store_id}`);\n\n    // Simulated analytics\n    const analytics = {\n      store_id,\n      period: `${period} days`,\n      overview: {\n        total_views: 1250,\n        total_clicks: 145,\n        total_conversions: 23,\n        total_revenue: 1840,\n        average_order_value: 80,\n        conversion_rate: 15.9\n      },\n      daily_data: [\n        { date: '2024-01-01', views: 42, clicks: 5, conversions: 1, revenue: 80 },\n        { date: '2024-01-02', views: 38, clicks: 4, conversions: 0, revenue: 0 },\n        { date: '2024-01-03', views: 55, clicks: 8, conversions: 2, revenue: 160 }\n      ],\n      top_products: [\n        { title: 'Premium Yoga Mat', sales: 12, revenue: 599.88 },\n        { title: 'Yoga Blocks Set', sales: 8, revenue: 319.92 }\n      ]\n    };\n\n    res.json({\n      success: true,\n      data: analytics,\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('âŒ Analytics error:', error.message);\n    res.status(500).json({\n      success: false,\n      error: error.message\n    });\n  }\n});\n\n// ===================================================\n// Optimize Store\n// ===================================================\n\nrouter.post('/:store_id/optimize', authMiddleware, async (req, res) => {\n  try {\n    const { store_id } = req.params;\n\n    console.log(`ðŸš€ Optimizing store: ${store_id}`);\n\n    // Simulated optimization\n    const optimization = {\n      store_id,\n      status: 'optimizing',\n      recommendations: [\n        {\n          type: 'speed',\n          title: 'Improve Page Speed',\n          description: 'Your store loads in 3.2s. Target: <2s',\n          impact: 'High',\n          action: 'Enable image compression'\n        },\n        {\n          type: 'conversion',\n          title: 'Add Trust Badges',\n          description: 'Add SSL, money-back guarantee badges',\n          impact: 'Medium',\n          action: 'Add security badges'\n        },\n        {\n          type: 'seo',\n          title: 'Improve SEO',\n          description: 'Add meta descriptions and keywords',\n          impact: 'Medium',\n          action: 'Update product descriptions'\n        }\n      ],\n      estimated_improvement: '23-35% conversion increase'\n    };\n\n    res.json({\n      success: true,\n      data: optimization,\n      message: 'Optimization started',\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('âŒ Optimization error:', error.message);\n    res.status(500).json({\n      success: false,\n      error: error.message\n    });\n  }\n});\n\nmodule.exports = router;\n
